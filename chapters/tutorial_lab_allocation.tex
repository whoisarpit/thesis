\chapter{Tutorial and Lab Allocation}

\section{Introduction}

Tutorial and lab allocation differs from lecture allocation in a few ways. Lectures being the largest piece of work involved in the delivery of a course, are allocated first, since they take up most of the faculty workload bandwidth. Tutorial and labs, however, are smaller pieces of work that can be allocated to faculty with lower remaining bandwidth. Thus, the tutorial and lab allocation allocation is done after the lecture allocation is done.

Tutorial and lab delivery is also more flexible than lecture delivery. This is because tutorials and labs require less expertise in the particular subject area, and thus can be delivered a broader range of faculty. This allows for more flexibility in the allocation of tutorials and labs. This reduces the need for a management priority of allocating earlier year courses to the best faculty.

The tutorial and lab allocation process needs to avoid fragmentation - it is preferred to allocate the tutorials and labs of a fewer number of courses to the same faculty, so that the faculty doesn't have to spend a lot of time preparing for different courses, each of which require them to familiarise themselves with a different course material. Additionally, the students get a more consistent experience across all the components of the course if the same faculty delivers the lectures, tutorials and labs of the same course.

To avoid fragmentation, we introduce batching of tutorials and labs. This involves dividing the tutorials and labs into batches of multiple tutorials and labs, and then allocating one batch of tutorials and labs at a time to the faculty. This ensures that the same faculty gets the opportunity to teach multiple sessions of the same tutorial. Additionally, the cost function is modified to bias the allocation of tutorials and labs to the same faculty who was allocated the lectures, tutorials or labs of the same course. This results in the same faculty being preferably allocated the lectures, tutorials and labs of the a course.

It was also found that purely operating on workload limits for the tutorial and lab allocation may lead to many small teaching duties being allocated to the faculty, which may lead to a lot of overhead for the faculty in terms of preparation and delivery. To counter this, limits are put on the total number of teaching duties that can be allocated to each faculty, as well as a limit to each of the lectures, tutorials and labs that can be allocated as well. This ensures that the faculty workload isn't too fragmented.

Techniques like pre-allocation, workload limit relaxation and post-allocation, discussed in the lecture allocation chapter, are also used in the tutorial and lab allocation process to ensure that the allocation is feasible. However, the workload limits placed on the faculty may lead to the allocation being infeasible for some exceptional cases. To resolve this, a mechanism is introduced to dynamically adjust the workload limits of the faculty in a targeted manner, to ensure that the unallocated tutorials and labs can be allocated to faculty.

In this chapter, a comprehensive approach to tutorial and lab allocation is discussed, which uses the hungarian algorithm to allocate the tutorials and labs to faculty, while utilizing the techniques discussed above to meet the objectives and constraints of the tutorial and lab allocation problem.

\section{Defining the Tutorial Allocation Problem}

The tutorial allocation involves allocating tutorials to faculty members who are eligible to deliver them. Tutorial allocation is similar to lecture allocation, which means that the objectives and constraints of the tutorial allocation problem are similar to the lecture allocation problem. This means that the tutorial allocation problem is also a multi-objective optimization problem, with a set of objectives that need to be optimized and a set of constraints that need to be satisfied.

The objectives of the lecture allocation - ensure that all courses are allocated, to ensure that the workload of faculty is distributed equitably, to ensure that the proportion of lectures, tutorials and labs allocated to each faculty is similar, to ensure that earlier year courses are allocated to the best faculty, to maximize the student feedback score and to maximize the faculty preferences - are also the objectives of the tutorial allocation problem.

However, there are a few additional considerations that need to be taken into account while modelling the tutorial allocation problem. These considerations are:

\begin{itemize}
  \item \textbf{Broader Availability of Faculty}

        Tutorials require less expertise in the particular subject area than lectures. Thus, tutorials can be delivered by a broader range of faculty. This allows for more flexibility in the allocation of tutorials. Thus, the tutorial allocation problem should be modelled in a way that the tutorials can be allocated to a broader range of faculty.

  \item \textbf{Consistency of Courses}

        The lectures, tutorials and labs of the same course should ideally be allocated to the same faculty. This is because the faculty would have to familiarise themselves with the course material of each course that they are allocated. Additionally, having the same faculty deliver the lectures, tutorials and labs of the same course would ensure that the students have a consistent experience across all the components of the course. Thus, the tutorial allocation problem should be modelled in a way that if the lectures of a course are allocated to a faculty, then they should get a higher preference for the tutorials of the same course.

  \item \textbf{Batching Tutorials}

        Tutorials are smaller pieces of work that are more numerous than lectures. Thus, it is not feasible to allocate tutorials one at a time, since it would lead to too many iterations. Additionally, allocating tutorials one at a time may lead to every tutorial session being allocated to a different faculty, which would lead to a lot of faculty having to familiarise themselves with the course material of a lot of courses, and the students. Thus, the tutorial allocation problem should be modelled in a way that the tutorials are allocated in batches.

\end{itemize}

As a result, the tutorial allocation problem is modelled differently from the lecture allocation problem. The next section discusses how the tutorial allocation problem is modelled.

\section{Modelling the Tutorial Allocation Problem}

The tutorial allocation problems, similar to the lecture allocation problem, can be modelled as an assignment problem where the tasks are the tutorials, and the resources are the faculty. Every tutorial will be assigned to exactly one faculty, but multiple tutorials or labs can be assigned to the same faculty, i.e. the tutorial allocation problems are many-to-one assignment problems.

The cost of allocating a tutorial to a faculty should take into consideration the student feedback and the faculty preferences. Additionally, the cost should be modelled such that consistency of courses can be maintained for tutorials.

The allocation process should also handle the management priority of allocating earlier year courses to the best faculty. Additionally, the allocation process should ensure that the workload of faculty is distributed equitably, and that a similar proportion of lectures, tutorials and labs are allocated to each faculty.

\subsection{Allocating using the Hungarian Algorithm}

Similar to the lecture assignment problem, the tutorial assignment is performed using the Hungarian algorithm. Since the algorithm only works for one-to-one assignment problems, the tutorial assignment problem is converted into a one-to-one assignment problem by running multiple iterations of the algorithm, where each iteration allocates exactly one session of tutorials to faculty.

The cost function for the lecture allocation problem is used as a starting point to define the cost function for the tutorial allocation problem. Thus, \autoref{eq:course_faculty_fit} is used as the course-faculty fit metric for the problem. This fit metric is then used to construct the allocation matrix as defined in \autoref{alg:cost_matrix_construction}. This cost matrix function is then used as input to the Hungarian algorithm, similar to the lecture allocation problem defined in \autoref{alg:base_lec_alloc}.

For the cost function, a separate set of student feedback and faculty preferences are provided for tutorials, to account for the different faculty delivering the tutorials, and the different student experience in tutorials. The faculty preferences for tutorials also tend to be broader, with more faculty being able to deliver tutorials than lectures.

However, the allocation process has a key difference - the tutorials involve multiple sessions of the same tutorial, each of which may be allocated to the same faculty as well. But since hungarian only allocates one task to one agent at a time, if multiple sessions of one tutorial are allocated in a single iteration, they will never be allocated to the same faculty. This would lead to the tutorials of the same course being allocated to different faculty, which leads to problems discussed previously.

As a result, the tutorial allocation process is modified to allocate only one session of each tutorial in each iteration. This ensures that the same faculty gets the opportunity to teach multiple sessions of the same tutorial. The allocation algorithm is thus defined as shown below.

\begin{algorithm}[H]
  \caption*{Base Tutorial Allocation Algorithm}
  \begin{algorithmic}
    \Procedure{AllocateTutorials}{$tutorials, faculty$}
    \State $unallocatedTutorialSessions \gets tutorials$
    \State $allAllocations \gets \emptyset$
    \While{$unallocatedTutorialSessions \neq \emptyset$}
    \State $iterationSessions \gets getFirstUnallocatedSession()$
    \State $costMatrix \gets constructCostMatrix(iterationSessions, faculty)$
    \State $allocation \gets \text{HungarianAlgorithm}(costMatrix)$
    \State $allAllocations \gets allAllocations \cup allocation$
    \State $unallocatedTutorialSessions \gets unallocatedTutorialSessions \setminus allocation$
    \EndWhile
    \State \textbf{return} $allAllocations$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

where, $tutorials$ is the set of all tutorials, and $faculty$ is the set of all faculty. The $constructCostMatrix$ function is defined as shown in \autoref{alg:cost_matrix_construction}. In every iteration, the allocation process takes the first unallocated tutorial session of each course and allocates it to a faculty. This ensures that the same faculty gets the opportunity to teach multiple sessions of the same tutorial.

In the next section, we discuss how the cost function is modified to improve consistency of courses, prioritize earlier year courses, and ensure equitable distribution of workload.

\section{Designing the Cost Function}

As mentioned in the previous section, we use the course-faculty fit metric defined in the lecture allocation process as the starting point for the cost function for the tutorial allocation problem. This fit metric is then used to construct the allocation matrix as defined in \autoref{alg:cost_matrix_construction}, which serves as the input to the Hungarian algorithm. However, the cost function needs to be modified to account for the different objectives and constraints of the tutorial allocation problem.

Firstly, to maintain consistency of courses, the cost function is modified to bias the allocation of tutorials to the same faculty who was allocated the lectures, tutorials or labs of the same course. This is done by reducing the cost of allocating a tutorial to the faculty by a certain bias if the faculty was allocated any existing tutorials or labs of the same course. Additionally, even if the faculty was allocated the lectures of the same course, the cost of allocating a tutorial to the faculty is reduced by the same bias, since the lectures, tutorials and labs of the same course should ideally be allocated to the same faculty.

Since the tutorial allocation process does not iterate over the tutorial sessions year-wise to achieve the management priority, the cost function is modified to bias the allocation of earlier year courses to the best faculty. This is done by reducing the cost of allocating a tutorial to a high quality faculty, and increasing the cost of allocating a tutorial to a low quality faculty, to ensure that the better faculty are allocated the earlier year courses. This bias is defined separately for each year, to allow for different degree of prioritization for different year courses, with the bias being higher for earlier year courses.

Finally, the cost function is modified to ensure that the workload of faculty is distributed equitably. This is done by limiting the total number of teaching duties that can be allocated to each faculty, as well as a limit to each of the lectures, tutorials and labs that can be allocated to each faculty. If the faculty has exceeded the workload limit, then the cost of allocating a tutorial to the faculty is set to infinity. This ensures that the faculty isn't overloaded with a sparse and fragmented workload.

\subsection{Preferring Already Allocated Courses}

We defined the allocation process which runs multiple iterations of the Hungarian algorithm, each iteration allocating one session of tutorials to faculty. This ensures that the same faculty gets the opportunity to teach multiple tutorial sessions of the same course. And although the multiple iterations of the algorithm allow for the same faculty to be allocated to multiple sessions of tutorials, there is no mechanism in the process to prefer the same faculty across multiple iterations of the algorithm.

We need to modify the algorithm with a mechanism to prefer a faculty for a tutorial, if the same faculty was allocated to previous sessions of tutorials for the same course. Additionally, we need to prefer a faculty for the tutorials of a course if the same faculty was allocated the lectures of the same course. This would ensure a consistent experience for the students across all the components of the course.

To do this, we modify the cost function to bias the allocation of tutorials to the same faculty who was allocated the lectures, tutorials or labs of the same course. This is done by reducing the cost of allocating a tutorial to the faculty by a certain bias if the faculty was allocated the lectures, tutorials or labs of the same course. This bias is configurable, and can be adjusted based on the management's preference towards consistency of courses. For the test dataset, a bias of 1 was found to be optimal, but this is a configurable parameter that can be adjusted based on the requirements of the institution.

With the bias, the modified cost matrix function is defined as shown below. The $consistencyBias$ parameter is configurable, and can be adjusted based on the management's preference towards consistency of courses. For the test dataset, a bias of 1 was found to be optimal, but this is a configurable parameter that can be adjusted based on the requirements of the institution.

\begin{algorithm}[H]
  \caption*{Refinement 1: Cost Matrix with Consistency Bias}
  \begin{algorithmic}
    \Procedure{ConstructCostMatrix}{$tutorials, faculty, existingAllocations$}
    \State $costMatrix \gets \emptyset$
    \For{$tutorial \in tutorials$}
    \For{$f \in faculty$}
    \State $costMatrix[tutorial][f] \gets \Call{Q}{tutorial, f}$
    \If{$f \in existingAllocations[tutorial.course]$}
    \State $costMatrix[tutorial][f] \gets costMatrix[tutorial][f] - consistencyBias$
    \EndIf
    \EndFor
    \EndFor
    \State \textbf{return} $costMatrix$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

where, $tutorials$ is the set of all tutorials, $faculty$ is the set of all faculty, and $existingAllocations$ is the set of all lectures, tutorials and labs that have already been allocated.

\subsection{Handling Management Priority}

In the lecture allocation problem, the management priority of allocating earlier year courses to the best faculty was handled by allocating the courses year-wise. This was done by allocating the courses of the first year first, then the courses of the second year, and so on. However, this approach is not feasible for the tutorial allocation problem, since ensuring consistency of courses already requires multiple iterations of the algorithm. Allocating the courses year-wise would lead to too many iterations of the algorithm, and would also lead to local optima, where the algorithm allocates too many tutorials to the same faculty for earlier year courses, and then is unable to allocate the tutorials of later year courses to the same faculty.

Additionally, since the tutorial sessions are secondary teaching duties, providing a supplementary experience to the lectures, it is not as important to reserve the best faculty for the earlier year courses. The tutorial sessions also don't require as much expertise in the particular subject area as the lectures, and thus aren't affected as much by the quality of the faculty. Thus, the allocation process is modified to allocate the tutorials of all years at once, instead of allocating the tutorials year-wise.

However, the management priority of allocating earlier year courses to the best faculty still needs to be handled. This is done by skewing the cost function to prioritize better faculty for earlier years. For earlier year courses, the cost of allocating a high quality faculty is reduced, and the cost of allocating a low quality faculty is increased, to ensure that the better faculty are allocated the earlier year courses. To achieve this, a bias factor is introduced, which is added or subtracted from the cost of allocating a faculty to a tutorial. This bias factor is configurable, and can be adjusted based on the management's preference towards allocating earlier year courses to the best faculty. The bias also has a different value for each year, to allow for different degree of prioritization for different year courses.

To differentiate high quality faculty from low quality faculty, a quality threshold is defined. If the cost of allocating a faculty to a tutorial is less than the quality threshold, then the faculty is considered to be high quality, and the bias is subtracted from the cost. If the cost of allocating a faculty to a tutorial is greater than the quality threshold, then the faculty is considered to be low quality, and the bias is added to the cost.

\begin{table}[H]
  \centering
  \begin{tabular}{|c|c|c|c|c|c|}
    \hline
    Year & 1 & 2    & 3   & 4    & 5 \\ \hline
    Bias & 1 & 0.75 & 0.5 & 0.25 & 0 \\ \hline
  \end{tabular}
  \caption{Yearwise Bias for Tutorial Allocation}
  \label{tab:yearwise_bias}
\end{table}

With the bias, the modified cost matrix function is defined as shown in \autoref{alg:cost_matrix_construction_yearwise_consistency}. The $qualityThreshold$ and $yearwiseBias$ parameters are configurable, and can be adjusted based on the management's preference towards allocating earlier year courses to the best faculty. For the test dataset, the biases are defined in \autoref{tab:yearwise_bias}. The $qualityThreshold$ is defined as 1, which means that any faculty with a cost of 1 or less is considered to be high quality, and any faculty with a cost of 1 to 5 is considered to be low quality.


\begin{algorithm}[H]
  \caption*{Refinement 2: Cost Matrix with Yearwise and Consistency Bias}
  \begin{algorithmic}
    \Procedure{ConstructCostMatrix}{$tutorials, faculty, existingAllocations$}
    \State $costMatrix \gets \emptyset$
    \For{$tutorial \in tutorials$}
    \For{$f \in faculty$}
    \State $cost \gets \Call{Q}{tutorial, f}$
    \State $year = tutorial.course.year$
    \If{$cost \leq qualityThreshold$}
    \State $cost \gets cost - yearwiseBias[year]$
    \Else
    \State $cost \gets cost + yearwiseBias[year]$
    \EndIf
    \If{$f \in existingAllocations[tutorial.course]$}
    \State $cost \gets cost - consistencyBias$
    \State $costMatrix[tutorial][f] \gets cost$
    \EndIf
    \EndFor
    \EndFor
    \State \textbf{return} $costMatrix$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

where, $tutorials$ is the set of all tutorials, $faculty$ is the set of all faculty, and $existingAllocations$ is the set of all lectures, tutorials and labs that have already been allocated.

\subsection{Distributing Teaching Duties Equitably}

The tutorial allocation process should ensure that the teaching duties are distributed equitably amongst faculty. One part of this is ensuring that a similar proportion of lectures, tutorials and labs are allocated to each faculty. This means that if the institution has a certain proportion of lectures, tutorials and labs, then the allocation of each faculty should ideally have a similar proportion of lectures, tutorials and labs. To achieve this, a mechanism needs to be introduced to limit the workload of lectures, tutorials and labs that can be allocated to each faculty.

Thus, the workload limits of the faculty are introduced with the same proportion of lectures, tutorials and labs as the institution. This is done incrementally, by first setting the workload limits of the faculty to only the proportion of lectures, and then increasing the workload limits to include the proportion of tutorials, and then increasing the workload limits to include the proportion of labs. This ensures that the workload of the faculty mimics the workload of the institution, and thus a similar proportion of lectures, tutorials and labs are allocated to each faculty.

For example, if the institute's workload consists of 60\% lectures, 20\% tutorials and 20\% labs, then during the lecture allocation process the workload limits of the faculty are set to only 60\% of the total workload limit of the faculty. This ensures that the lecture allocation process allocates only 60\% of the total workload limit of the faculty to lectures. Then for the tutorial allocation process, the workload limits are increased to 80\% of the total workload limit of the faculty. And then finally, for the lab allocation process, the workload limits are increased to 100\% of the total workload limit of the faculty.

This also means that if a faculty was under-allocated lectures, which can happen resulting from various factors like their preferences or student feedback, then the faculty would be allocated more tutorials to compensate for the under-allocation of lectures. This ensures that, while the workload of the faculty is distributed in a similar proportion to the workload of the institution, the faculty workload isn't underutilized.

The second part of the workload distribution is ensuring that the workload of the faculty isn't too fragmented. This means that the faculty shouldn't be overloaded with many small teaching duties, which might be able to fit within the workload limits of the faculty, but would lead to a lot of overhead for the faculty in terms of preparation and delivery, as well as commuting between the different teaching duties. To achieve this, a limit is put on the total number of teaching duties that can be allocated to each faculty Additionally, a limit to each of the lectures, tutorials and labs is also added.

These teaching duty limits are defined separately for professors and lecturers, since lecturers are expected to have less research commitments than professors, and can thus be allocated more teaching duties. The limits used in the test dataset are defined in \autoref{tab:teaching_duty_limits}.

\begin{table}[H]
  \centering
  \begin{tabular}{|c|c|c|c|c|}
    \hline
    Faculty Type & Total & Lectures & Tutorials & Labs \\ \hline
    Professor    & 10    & 3        & 5         & 6    \\ \hline
    Lecturer     & 20    & 3        & 10        & 12   \\ \hline
  \end{tabular}
  \caption{Teaching Duty Limits for Faculty}
  \label{tab:teaching_duty_limits}
\end{table}

The final cost matrix function is defined as a procedure in \autoref{fig:tutorial_allocation_flow}.

\section{Batch Allocation of Tutorials}

Another way to improve consistency of courses is to allocate the tutorials in batches. This involves dividing the tutorials into batches of multiple tutorials, and then allocating one batch of tutorials at a time to the faculty. This ensures that the faculty is assigned at least a few sessions of the same tutorial, which improves the consistency of courses. This adds a certainty that the algorithm will allocate the faculty densely, allocating more sessions of the same tutorial to the same faculty in order to ensure consistency of courses.

Additionally, since the tutorial allocation problem is completed in multiple iterations, each iteration of the algorithm assigning one tutorial to one faculty, the allocation process can take a long time to complete. This is because one course can have a large number of students studying the course. For this, a large number of tutorials need to be allocated, since each tutorial session can only accommodate a limited number of students. For a course with 800 students, 26 separate tutorial sessions are needed, each with around 30 students. This means that at least 26 separate iterations of the algorithm need to be run to allocate all the tutorials for the course.

To achieve this, the tutorial allocation algorithm is modified to allocate the tutorials in batches. This is done by creating a batch of tutorials, and then allocating the batch to faculty. This ensures that the algorithm allocates the tutorials densely, allocating more sessions of the same tutorial to the same faculty. This also reduces the number of iterations of the algorithm that need to be run, since the algorithm allocates multiple tutorials in one iteration.

Determining the correct batch size is important, since a batch size that is too large would require higher workload limits to accommodate the entire batch of tutorials, leading to unallocated tutorials and sub-optimal faculty utilization. However, a batch size that is too granular would lead to fragmentation of the course tutorials, with multiple faculty being allocated to the tutorials of the same course. Additionally, smaller batch sizes also result in a slower allocation process due to more iterations required.

The batch size is a configurable parameter that can be adjusted based on the requirements of the institution. It is a function of the management's preference towards consistency, as well as the availability of faculty to deliver the tutorials. For tutorials, a batch size of 2 was found to be optimal for the test dataset, to provide optimal granularity while ensuring consistency of courses.

With the batch allocation, the tutorials are divided in batches of size $batchSize$ before the allocation begins, and then the algorithm is modified to select the first unallocated batch of tutorials for cost matrix construction, instead of the first unallocated session.


\section{The Tutorial Allocation Process}

In the tutorial allocation algorithm, the tutorial sessions are divided into batches of size $batchSize$. Then, the algorithm runs multiple iterations of the Hungarian algorithm, each iteration allocating one batch of tutorials to faculty. In each iteration, the algorithm constructs the cost matrix using the cost matrix function defined below, which takes into account the consistency of courses, the management priority of allocating earlier year courses to the best faculty, and ensures the workload limits of the faculty are not exceeded. The algorithm then allocates the tutorials to faculty, and then repeats the process until all the batches of tutorials have been allocated. This algorithm is defined in \autoref{alg:tutorial_allocation}.

\begin{algorithm}[H]
  \caption{Tutorial Allocation Algorithm}
  \begin{algorithmic}
    \Procedure{AllocateTutorials}{$tutorials, faculty$}
    \State $allAllocations \gets \emptyset$
    \State $unallocatedBatches \gets divideIntoBatches(tutorials, batchSize)$
    \While{$unallocatedBatches \neq \emptyset$}
    \State $iterationBatches \gets \text{First Unallocated Batch per Course}$
    \State $costMatrix \gets \Call{ConstructCostMatrix}{iterationBatches}$
    \State $allocation \gets \text{HungarianAlgorithm}(costMatrix)$
    \State $allAllocations \gets allAllocations \cup allocation$
    \State $unallocatedBatches \gets unallocatedBatches \setminus allocation$
    \EndWhile
    \State \textbf{return} $allAllocations$
    \EndProcedure
    \\
    \Procedure{ConstructCostMatrix}{$batches$}
    \State $costMatrix \gets \emptyset$
    \For{$batch \in batches$}
    \For{$f \in faculty$}
    \State $cost \gets \Call{Q}{batch, f}$
    \State $year = batch.course.year$
    \If{$cost \leq qualityThreshold$}
    \State $cost \gets cost - yearwiseBias[year]$
    \Else
    \State $cost \gets cost + yearwiseBias[year]$
    \EndIf
    \If{$f \in existingAllocations[batch.course]$}
    \State $cost \gets cost - consistencyBias$
    \EndIf
    \If {$f$ has exceeded \textbf{total teaching duty limit} or \textbf{tutorial limit}}
    \State $cost \gets \infty$
    \EndIf
    \State $costMatrix[batch][f] \gets cost$
    \EndFor
    \EndFor
    \State \textbf{return} $costMatrix$
    \EndProcedure
  \end{algorithmic}
  \label{alg:tutorial_allocation}
\end{algorithm}

where, $tutorials$ is the set of all tutorials, $faculty$ is the set of all faculty, and $batchSize$ is the size of the batch of tutorials. The $divideIntoBatches$ function just divides the tutorials into batches of size $batchSize$. If the number of tutorials is not a multiple of $batchSize$, then the last batch will have less than $batchSize$ tutorials.

The $constructCostMatrix$ function is defined in the second procedure, which incorporates the teaching duty limits, the yearwise bias, the consistency bias, and the workload limits of the faculty. The $qualityThreshold$, $consistencyBias$, $yearwiseBias$ and workload limits for every faculty are defined in the previous chapters. Each of these parameters is configurable and can be adjusted as per the needs of the institution. The $existingAllocations$ is the set of all lectures, tutorials and labs that have already been allocated.

Additionally, we also incorporate the pre-allocation, and workload limit relaxation steps from the lecture allocation process. The pre-allocation step involves allocating the tutorials that have a shortage of faculty before the allocation process begins. The workload limit relaxation step involves relaxing the workload limits of the faculty to accommodate the tutorials that have not been allocated.

The post-allocation step was not found to be useful, since it primarily helped with unallocated lectures caused by the management priority of allocating earlier year courses to the best faculty. Since the tutorial allocation process doesn't allocate the tutorials year-wise, and instead uses the year-wise bias to allocate earlier year courses to the best faculty, the post-allocation step was found to be unhelpful.

The entire allocation flow used for is defined as shown in \autoref{fig:tutorial_allocation_flow}.

\begin{figure}[H]
  \centering
  \begin{tikzpicture}[node distance=0.5cm]
    \node (start) [startstop] {Start};
    \node (workload_limits) [process, below=of start] {Increase Workload Limits};
    \node (batch) [process, below=of workload_limits] {Divide into Batches};
    \node (prealloc) [process, below=of batch] {Pre-Allocation};
    \node (iter) [process, below=of prealloc] {Allocate Tutorial Batches};
    \node (workload_check) [decision, below=of iter] {All Allocated?};
    \node (workload) [process, right=of workload_check, xshift=0.25cm] {Relax Workload Limits};
    \node (stop) [startstop, below=of workload_check, yshift=-0.25cm] {Stop};

    \draw [arrow] (start) edge (workload_limits)
    (workload_limits) edge (batch)
    (batch) edge (prealloc)
    (prealloc) edge (iter)
    (iter) edge (workload_check)
    (workload_check) edge node[anchor=south] {No} (workload)
    (workload_check) edge node[anchor=east] {Yes} (stop)
    (workload) edge[out=270, in=90] (stop);
    \node [draw=red, fit=(workload_limits) (batch), inner sep=0.25cm, dashed, label={left:Preparation}] {};
    \node [draw=red, fit=(prealloc) (iter), inner sep=0.25cm, dashed, label={left:Allocation}] {};
    \node [draw=red, fit=(workload_check) (workload), inner sep=0.25cm, dashed, label={left:Fixing Unallocated Tutorials}] {};
  \end{tikzpicture}
  \caption{Tutorial Allocation Flow}
  \label{fig:tutorial_allocation_flow}
\end{figure}

The process begins by increasing the workload limits of the faculty to include tutorials. Then, the tutorial sessions are divided into batches of size $batchSize$. Then we run the pre-allocation process, which allocates the tutorials that have a shortage of faculty. Then, the algorithm runs multiple iterations of the allocation, each iteration allocating one batch of tutorials to faculty. In each iteration, the algorithm constructs the cost matrix which takes into account the consistency of courses, the management priority of allocating earlier year courses to the best faculty, and ensures the workload limits of the faculty are not exceeded. The hungarian algorithm then allocates the tutorials to faculty, and then repeats the process until all the batches of tutorials have been allocated. This is followed by relaxing the workload limits of the faculty to accommodate the tutorials that have not been allocated, if the need arises.

\section{The Lab Allocation Process}

The lab allocation process is identical to the tutorial allocation process, and is carried out right after the tutorial allocation process. This involves batching of labs, and then running multiple iterations of the Hungarian algorithm, each iteration allocating one batch of labs to faculty. In each iteration, the cost matrix construction incorporates the consistency of courses, the management priority of allocating earlier year courses to the best faculty, and ensures the workload and teaching duty limits of the faculty are not exceeded.

For lab allocation, the optimal batch size was also found to be 2, which is counter-intuitive since labs are typically twice as long as tutorials. However, because the workload per hour of lab is considered to be lower than the workload per hour of tutorial, the two factors balance out, and the optimal batch size for labs is also 2. This also makes intuitive sense since workload granularity is of primary importance, not the number of hours allocated to each faculty.



\section{Experimental Results}

The tutorial allocation process uses the Hungarian algorithm to allocate the tutorials to faculty in batches. The algorithm is run multiple times, each time allocating one batch of tutorials to faculty. The algorithm is run until as many tutorials as possible are allocated to faculty, and then the unallocated tutorials are resolved by expanding the workload limits of the faculty, and if that fails, by reshuffling the allocations of the tutorials through the post-allocation process.

Using this approach, the tutorial allocation algorithms were run on the dataset of the School of Computer Science and Engineering, Nanyang Technological University, Singapore. The results of this allocation are shown below.

\begin{table}[h]
  \centering
  \begin{tabular}{|l|c|c|}
    \hline
    \textbf{Metric} & \textbf{Tutorial} & \textbf{Lab} \\ \hline
    Assigned        & 518               & 491          \\
    Assigned Hrs    & 6706              & 5076         \\ \hline
    Unassigned      & 4                 & 0            \\
    Unassigned Hrs  & 52                & 0            \\ \hline
    Avg Score       & 3.71              & 3.44         \\
    \hline
  \end{tabular}
  \caption{Tutorial Allocation Results}
  \label{tab:tut_lab_allocation_results}
\end{table}

\autoref{tab:tut_lab_allocation_results} shows the results of the tutorial allocation process. The process was able to allocate 518 out of 522 tutorials, and 491 out of 491 labs. In hours, this is 6706 out of 6758 tutorial hours, which is 99.23\% of the total tutorial hours, and 5076 out of 5076 lab hours, which is 100\% of the total lab hours.

\begin{figure}[H]
  \centering

  \begin{tikzpicture}
    \begin{axis}[
        xlabel={Utilization},
        ylabel={Number of Faculty},
        xmin=0, xmax=180,
        ymin=0,
        ymajorgrids=true,
        grid style=dashed,
        legend style={at={(0.05,0.95)}, anchor=north west, nodes={scale=0.85, transform shape}}
      ]
      \addplot[color=gray, mark=square]
      coordinates {
          (0, 12) (10, 0) (20, 0) (30, 0) (40, 3) (50, 5) (60, 4) (70, 4) (80, 6) (90, 4) (100, 15) (110, 12) (120, 7) (130, 15) (140, 7) (150, 10) (160, 6) (170, 4)
        };
      \addlegendentry{After Lec Allocation}
      \addplot[color=blue, mark=triangle]
      coordinates {
          (0,1) (10,0) (20,0) (30,2) (40,2) (50,2) (60,4) (70,3) (80,6) (90,22) (100,25) (110,7) (120,14) (130,8) (140,14) (150,2) (170,1) (180,1)
        };
      \addlegendentry{After Tut Allocation}
      \addplot[color=red, mark=o]
      coordinates {
          (0, 0) (10, 0) (20, 0) (30, 3) (40, 0) (50, 3) (60, 5) (70, 4) (80, 2) (90, 10) (100, 30) (110, 21) (120, 13) (130, 7) (140, 10) (150, 4) (160, 0) (170, 2)
        };
      \addlegendentry{After Lab Allocation}
    \end{axis}
  \end{tikzpicture}
  \caption{Faculty Utilization for Tutorial Allocation}
  \label{fig:tut_faculty_utilization}
\end{figure}

\autoref{fig:tut_faculty_utilization} shows the utilization of faculty for the tutorial allocation process. The utilization of faculty is defined as the number of hours allocated to the faculty divided by the total workload limit of the faculty. This also means that the utilization of faculty is inclusive of the lecture allocation process, since the lecture allocation process is run before the tutorial allocation process.

One consistent pattern that can be seen in the utilization of faculty is that optimal utilization of faculty, i.e. 100\% utilization, is achieved for more faculty as the tutorial allocation processes are completed, while over-utilized and under-utilized faculty remain nearly constant. This is because many more faculty are available to teach tutorials than lectures, as previously discussed, the broader availability resulting from the lower expertise required to teach tutorials. It can be seen that the number of faculty with 0\% utilization decreases from 12 to 0, which confirms the above finding.

Relatively few faculty are over-utilized, with only 23 faculty having a utilization of more than 120\%. This is because overutilization of faculty in lecture allocation was overutilization of lecture workload limits. But since the workload limits of the faculty are increased to include tutorials, the originally over-utilized faculty are no longer over-utilized.

\subsection{Impact of Consistency Bias}

\begin{figure}[H]
  \begin{subfigure}[h]{0.5\linewidth}
    \centering
    \begin{tikzpicture}[xscale=0.75, yscale=0.75]
      \begin{axis}[
          xlabel={Consistency Bias},
          ylabel={Avg No. of Faculty per Course},
          ymin=1.5, ymax=3,
          ymajorgrids=true,
          grid style=dashed,
          cycle list name=exotic,
        ]
        \addplot coordinates{
            (0, 2.278481012658228)
            (0.5, 2.0253164556962027)
            (1, 2.0126582278481013)
            (1.5, 2.0126582278481013)
            (2, 2.0126582278481013)
            (2.5, 2.0)
            (3, 2.0)
            (3.5, 2.0)
            (4, 2.0)
          };
        \addlegendentry{Tut Allocations}
        \addplot coordinates{
            (0, 2.9649122807017543)
            (0.5, 2.3508771929824563)
            (1, 2.245614035087719)
            (1.5, 2.245614035087719)
            (2, 2.245614035087719)
            (2.5, 2.2982456140350878)
            (3, 2.2982456140350878)
            (3.5, 2.3157894736842106)
            (4, 2.3157894736842106)
          };
        \addlegendentry{Lab Allocations}
      \end{axis}
    \end{tikzpicture}
    \caption{on Faculty per Course}
    \label{fig:faculty_per_course_consistency_bias}
  \end{subfigure}
  \begin{subfigure}[h]{0.5\linewidth}
    \centering
    \begin{tikzpicture}[xscale=0.75, yscale=0.75]
      \begin{axis}[
          xlabel={Consistency Bias},
          ylabel={Avg Course-Faculty Fit},
          ymin=3.0, ymax=4,
          ymajorgrids=true,
          grid style=dashed,
          cycle list name=exotic,
        ]
        \addplot coordinates{
            (0, 3.707942)
            (0.5, 3.699639)
            (1, 3.710108)
            (1.5, 3.710108)
            (2, 3.710108)
            (2.5, 3.693141)
            (3, 3.693141)
            (3.5, 3.693141)
            (4, 3.693141)
          };
        \addlegendentry{Tut Allocations}
        \addplot coordinates{
            (0, 3.500000)
            (0.5, 3.480620)
            (1, 3.460078)
            (1.5, 3.460078)
            (2, 3.460078)
            (2.5, 3.475969)
            (3, 3.475969)
            (3.5, 3.477132)
            (4, 3.477132)
          };
        \addlegendentry{Lab Allocations}
      \end{axis}
    \end{tikzpicture}
    \caption{on Course-Faculty Fit}
    \label{fig:score_consistency_bias}
  \end{subfigure}
  \caption{Impact of Consistency Bias}
\end{figure}


As seen in the figure, the consistency bias has a significant impact on the number of faculty per course. As the consistency bias is increased, the number of faculty per course decreases significantly. For tutorials, 2.28 faculty per course in the absence of consistency bias, the number of faculty per course decreases to 2.02 faculty per course with a consistency bias of 1. For labs, 2.96 faculty per course in the absence of consistency bias reduces to 2.25 faculty per course with a consistency bias of 1.

An interesting observation is that the consistency bias actually increases the number of faculty per course for labs for a consistency bias of 2.5 or higher. Upon further investigation, it was found that this was because faculty with a high workload limit tend to prefer to teach tutorials and labs of courses with a high number of sessions. However, because the consistency bias pushes the faculty previously allocated to lectures to also be allocated to tutorials and labs, this very high bias leads to such preferences being overridden, leading to suboptimal allocation of faculty.

It can also be seen in \autoref{fig:score_consistency_bias} that the consistency bias has a negligible impact on the course-faculty fit, thus ensuring that the consistency bias doesn't affect the quality of the allocation. The course-faculty fit of tutorials remains nearly constant at 3.70, and the course-faculty fit of labs remains nearly constant at 3.48.

This shows that the consistency bias is effective in reducing the number of faculty per course, and thus improving the consistency of courses. A consistency bias of 1 was found to be optimal for the test dataset, but this is a configurable parameter that can be adjusted based on the requirements of the institution.

\subsection{Impact of Yearwise Bias}

\begin{figure}[H]
  \begin{subfigure}[h]{0.5\linewidth}
    \centering
    \begin{tikzpicture}[xscale=0.75, yscale=0.75]
      \begin{axis}[
          xlabel={Yearwise Bias},
          ylabel={Avg Course-Faculty Fit},
          ymin=3.55, ymax=3.85,
          symbolic x coords={0, 0.5, 1, 2, 3, 5, 25},
          ymajorgrids=true,
          grid style=dashed,
          cycle list name=exotic,
        ]

        \addplot coordinates {
            (0, 3.640196)
            (0.5, 3.643137)
            (1, 3.657843)
            (2, 3.657843)
            (3, 3.626471)
            (5, 3.626471)
            (25, 3.635294)
          };
        \addlegendentry{Year 1};

        \addplot coordinates {
            (0, 3.563830)
            (0.5, 3.590426)
            (1, 3.552128)
            (2, 3.548936)
            (3, 3.579787)
            (5, 3.582979)
            (25, 3.556383)
          };
        \addlegendentry{Year 2};

        \addplot coordinates {
            (0, 3.711905)
            (0.5, 3.704762)
            (1, 3.673810)
            (2, 3.683333)
            (3, 3.666667)
            (5, 3.666667)
            (25, 3.642857)
          };
        \addlegendentry{Year 3};

        \addplot coordinates {
            (0, 3.654054)
            (0.5, 3.629730)
            (1, 3.600000)
            (2, 3.600000)
            (3, 3.613514)
            (5, 3.613514)
            (25, 3.621622)
          };
        \addlegendentry{Year 4};
      \end{axis}
    \end{tikzpicture}
    \caption{Tutorial Allocation}
    \label{fig:tut_score_yearwise_bias}
  \end{subfigure}
  \begin{subfigure}[h]{0.4\linewidth}
    \centering
    \begin{tikzpicture}[xscale=0.75, yscale=0.75]
      \begin{axis}[
          xlabel={Yearwise Bias},
          ylabel={Avg Course-Faculty Fit},
          ymin=3.35, ymax=3.65,
          symbolic x coords={0, 0.5, 1, 2, 3, 5, 25},
          ymajorgrids=true,
          grid style=dashed,
          cycle list name=exotic,
        ]
        \addplot coordinates {
            (0, 3.488983)
            (0.5, 3.479661)
            (1, 3.491525)
            (2, 3.466102)
            (3, 3.485593)
            (5, 3.485593)
            (25, 3.510169)
          };
        \addlegendentry{Year 1};

        \addplot coordinates {
            (0, 3.435227)
            (0.5, 3.439773)
            (1, 3.436364)
            (2, 3.454545)
            (3, 3.448864)
            (5, 3.448864)
            (25, 3.423864)
          };
        \addlegendentry{Year 2};

        \addplot coordinates {
            (0, 3.387234)
            (0.5, 3.395745)
            (1, 3.408511)
            (2, 3.408511)
            (3, 3.385106)
            (5, 3.385106)
            (25, 3.414894)
          };
        \addlegendentry{Year 3};

        \addplot coordinates {
            (0, 3.460000)
            (0.5, 3.460000)
            (1, 3.440000)
            (2, 3.440000)
            (3, 3.440000)
            (5, 3.440000)
            (25, 3.580000)
          };
        \addlegendentry{Year 4};
      \end{axis}
    \end{tikzpicture}
    \caption{Lab Allocation}
    \label{fig:lab_score_yearwise_bias}
  \end{subfigure}
  \caption{Impact of Yearwise Bias on Course-Faculty Fit}
\end{figure}

It can be seen in \autoref{fig:tut_score_yearwise_bias} that the yearwise bias has an impact on the course-faculty fit of tutorials, although the impact is not significant. The course-faculty fit of tutorials for year 1 improves from 3.74 to 3.75 by changing the yearwise bias from 0 to 0.5, and then remains nearly constant at 3.74 for higher values of the yearwise bias. The course-faculty fit of tutorials for year 2 improves from 3.68 to 3.69 by changing the yearwise bias from 0 to 0.5, and then remains nearly constant at 3.68 for higher values of the yearwise bias. For year 3 and 4, increase in the yearwise bias  results in a decrease in the course-faculty fit of tutorials, from 3.72 to 3.69 for year 3, and from 3.65 to 3.62 for year 4. This shows that the yearwise bias has a negligible impact on the course-faculty fit of tutorials.

However, upon increasing the consistency bias further, the course-faculty fit of tutorials decreases across all years. The reason for this was found to be the yearwise bias causing greedy allocation of faculty such that the faculty with the highest student feedback are allocated to some year courses at the expense of lower feedback faculty being allocated to the rest of the courses for the year. This is due to the not enough faculty being available to teach the courses with the high student feedback.



\subsection{Impact of Teaching Duty Limits}

\subsection{Impact of Batch Size}

\begin{figure}[H]
  \begin{subfigure}[h]{0.5\linewidth}
    \centering
    \begin{tikzpicture}[xscale=0.75, yscale=0.75]
      \begin{axis}[
          xlabel={Batch Size},
          ylabel={Avg Staff per Course},
          ymajorgrids=true,
          grid style=dashed,
          cycle list name=exotic,
        ]
        \addplot coordinates{
            (1, 2.2911392405063293)
            (2, 2.0126582278481013)
            (3, 1.8860759493670887)
            (4, 1.6962025316455696)
            (5, 1.5316455696202531)
            (6, 1.4303797468354431)
            (7, 1.4050632911392404)
            (8, 1.3164556962025316)
            (9, 1.2911392405063291)
            (10, 1.2658227848101267)
          };
        \addlegendentry{Tut};

        \addplot coordinates{
            (1, 2.526315789473684)
            (2, 2.3859649122807016)
            (3, 2.175438596491228)
            (4, 1.894736842105263)
            (5, 1.7894736842105263)
            (6, 1.6666666666666667)
            (7, 1.5789473684210527)
            (8, 1.543859649122807)
            (9, 1.4385964912280702)
            (10, 1.4210526315789473)
          };
        \addlegendentry{Lab};
      \end{axis}
    \end{tikzpicture}
    \caption{on Faculty per Course}
    \label{fig:faculty_per_course_batch_size}
  \end{subfigure}
  \begin{subfigure}[h]{0.4\linewidth}
    \centering
    \begin{tikzpicture}[xscale=0.75, yscale=0.75]
      \begin{axis}[
          xlabel={Batch Size},
          ylabel={Avg Course-Faculty Fit},
          ymajorgrids=true,
          grid style=dashed,
          cycle list name=exotic,
        ]
        \addplot coordinates{
            (1, 3.705172)
            (2, 3.685921)
            (3, 3.675377)
            (4, 3.648765)
            (5, 3.650694)
            (6, 3.649593)
            (7, 3.635345)
            (8, 3.628704)
            (9, 3.663725)
            (10, 3.656000)
          };
        \addlegendentry{Tut};

        \addplot coordinates{
            (1, 3.483910)
            (2, 3.494186)
            (3, 3.459116)
            (4, 3.481379)
            (5, 3.475397)
            (6, 3.499057)
            (7, 3.504040)
            (8, 3.518681)
            (9, 3.509524)
            (10, 3.530864)
          };
        \addlegendentry{Lab};
      \end{axis}
    \end{tikzpicture}
    \caption{on Course-Faculty Fit}
    \label{fig:score_batch_size}
  \end{subfigure}
  \par \bigskip
  \begin{subfigure}[h]{\linewidth}
    \centering
    \begin{tikzpicture}[xscale=0.75, yscale=0.75]
      \begin{axis}[
          xlabel={Batch Size},
          ylabel={Number of Overallocated Faculty},
          ymajorgrids=true,
          grid style=dashed,
          cycle list name=exotic,
        ]
        \addplot coordinates{};
        \addplot coordinates{};
        \addplot coordinates{
            (1, 71)
            (2, 63)
            (3, 59)
            (4, 61)
            (5, 60)
            (6, 47)
            (7, 46)
            (8, 48)
            (9, 51)
            (10, 49)
          };
      \end{axis}
    \end{tikzpicture}
    \caption{on Faculty Overloading}
    \label{fig:overloading_batch_size}
  \end{subfigure}
  \caption{Impact of Batch Size}
\end{figure}

The batch size has a significant impact on the number of faculty per course, as seen in \autoref{fig:faculty_per_course_batch_size}. As the batch size is increased, the number of faculty per course decreases significantly. For tutorials, 2.29 faculty per course in the absence of batch allocation, the number of faculty per course decreases to 1.26 faculty per course with a batch size of 10. For labs, 2.53 faculty per course in the absence of batch allocation reduces to 1.42 faculty per course with a batch size of 10.

It can also be seen in \autoref{fig:score_batch_size} that the batch size has a tangible impact on the course-faculty fit of tutorials, with the course-faculty fit of tutorials increasing from 3.71 to 3.66 by changing the batch size from 1 to 10. However, the impact of the batch size on the course-faculty fit of labs is reverse, with the course-faculty fit of labs improving from 3.48 to 3.53 by changing the batch size from 1 to 10.

TODO: Refine

\subsection{Impact of Pre-Allocation and Workload Limit Relaxation}

\section{Dynamically Adjusting Workload Limits for Feasibility}

% Talks about how the workload limits are dynamically adjusted to ensure that the allocation is feasible. This is done by adjusting the workload limits and the constraint on the total number of teaching duties that can be allocated to each faculty.

% Talks about how this is done through iterative adjustment, detecting if the workload limit or the max allocation limit is responsible for the infeasibility and adjusting the workload limit or the max allocation limit accordingly.

Although the tutorial allocation process manages to allocate most of the tutorials, there are still some tutorials that remain unallocated due to the workload limits of the faculty or the total number of teaching duties that can be allocated to each faculty. This is because the workload limits of the faculty are set to the workload limits of the institution, which are based on the proportion of lectures, tutorials and labs in the institution. However, allocation of all the tutorials is the primary objective of the tutorial allocation process. Thus, the workload limits of the faculty need to be adjusted to accommodate the tutorials that have not been allocated.

To achieve this, a method of dynamically adjusting the workload limits of the faculty is introduced. This involves identifying the cause of the infeasibility, i.e. whether the workload limit of the faculty is responsible for the infeasibility, or whether the total number of teaching duties that can be allocated to each faculty is responsible for the infeasibility. Then, the workload limit of the faculty or the total number of teaching duties that can be allocated to each faculty is adjusted accordingly, to ensure that the allocation is feasible.

This is done by iteratively adjusting the workload limits of the faculty, and then checking if the allocation is feasible. If the allocation is feasible, then the process is complete.

\section{Comprehensive approach to Tutorial Allocation}

% Describes the entire process of tutorial allocation, along with the figure of the steps involved.

\section{Overview of Course Allocation Process}


\section{Summary}
